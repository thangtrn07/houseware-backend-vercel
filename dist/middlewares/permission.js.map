{"version":3,"sources":["../../src/middlewares/permission.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\r\nimport { Roles } from '~/types/roles';\r\nimport { BadRequestException, ForbiddenException, UnauthorizedException } from '~/utils/response';\r\n\r\nexport const forwardAuthenticated = (req: Request, res: Response, next: NextFunction) => {\r\n   const user = req.user;\r\n   if (!req.isAuthenticated()) {\r\n      next();\r\n   } else {\r\n      throw new BadRequestException('Bạn đã đăng nhập rồi.');\r\n   }\r\n};\r\n\r\nexport const permission = (role?: Roles) => {\r\n   return (req: Request, res: Response, next: NextFunction) => {\r\n      const user = req.user;\r\n      if (!req.isAuthenticated()) {\r\n         throw new UnauthorizedException('Vui lòng đăng nhập');\r\n      }\r\n      if (!role) {\r\n         next();\r\n      } else if (user?.role === role || user.role === Roles.ADMIN) {\r\n         next();\r\n      } else {\r\n         throw new ForbiddenException('Bạn chưa được uỷ quyền.');\r\n      }\r\n   };\r\n};\r\n"],"names":["forwardAuthenticated","permission","req","res","next","user","isAuthenticated","BadRequestException","role","UnauthorizedException","Roles","ADMIN","ForbiddenException"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAIaA,oBAAoB;eAApBA;;IASAC,UAAU;eAAVA;;;uBAZS;0BACyD;AAExE,MAAMD,uBAAuB,CAACE,KAAcC,KAAeC;IAC/D,MAAMC,OAAOH,IAAIG,IAAI;IACrB,IAAI,CAACH,IAAII,eAAe,IAAI;QACzBF;IACH,OAAO;QACJ,MAAM,IAAIG,6BAAmB,CAAC;IACjC;AACH;AAEO,MAAMN,aAAa,CAACO;IACxB,OAAO,CAACN,KAAcC,KAAeC;QAClC,MAAMC,OAAOH,IAAIG,IAAI;QACrB,IAAI,CAACH,IAAII,eAAe,IAAI;YACzB,MAAM,IAAIG,+BAAqB,CAAC;QACnC;QACA,IAAI,CAACD,MAAM;YACRJ;QACH,OAAO,IAAIC,CAAAA,iBAAAA,2BAAAA,KAAMG,IAAI,MAAKA,QAAQH,KAAKG,IAAI,KAAKE,YAAK,CAACC,KAAK,EAAE;YAC1DP;QACH,OAAO;YACJ,MAAM,IAAIQ,4BAAkB,CAAC;QAChC;IACH;AACH"}