{"version":3,"sources":["../../src/middlewares/uploader.ts"],"sourcesContent":["import { CloudinaryStorage } from 'multer-storage-cloudinary';\r\nimport cloudinary from '~/config/cloudinary';\r\nimport multer from 'multer';\r\nimport { BadRequestException } from '~/utils/response';\r\n\r\nconst storage = new CloudinaryStorage({\r\n   cloudinary: cloudinary,\r\n   params: () => {\r\n      return {\r\n         folder: 'housewares'\r\n      };\r\n   }\r\n});\r\n\r\nconst uploader = multer({\r\n   storage,\r\n   fileFilter: async (req, file, cb) => {\r\n      const whitelist = ['image/png', 'image/jpeg', 'image/jpg', 'image/webp'];\r\n      if (!whitelist.includes(file.mimetype)) {\r\n         return cb(new BadRequestException('This file is not allowed'));\r\n      }\r\n      cb(null, true);\r\n   }\r\n});\r\n\r\nexport const destroy = async (public_id: string) => {\r\n   try {\r\n      const { result } = await cloudinary.uploader.destroy(public_id);\r\n      if (result === 'not found') {\r\n         return 'Not found image to delete';\r\n      } else if (result === 'ok') {\r\n         return 'Deleted successfully';\r\n      }\r\n      return result;\r\n   } catch (error) {\r\n      return 'Delete failed.';\r\n   }\r\n};\r\n\r\nexport default uploader;\r\n"],"names":["destroy","storage","CloudinaryStorage","cloudinary","params","folder","uploader","multer","fileFilter","req","file","cb","whitelist","includes","mimetype","BadRequestException","public_id","result","error"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAuCA,OAAwB;eAAxB;;IAdaA,OAAO;eAAPA;;;yCAzBqB;qDACX;iDACJ;0BACiB;;;;;;AAEpC,MAAMC,UAAU,IAAIC,0CAAiB,CAAC;IACnCC,YAAYA,mBAAU;IACtBC,QAAQ;QACL,OAAO;YACJC,QAAQ;QACX;IACH;AACH;AAEA,MAAMC,WAAWC,IAAAA,eAAM,EAAC;IACrBN;IACAO,YAAY,OAAOC,KAAKC,MAAMC;QAC3B,MAAMC,YAAY;YAAC;YAAa;YAAc;YAAa;SAAa;QACxE,IAAI,CAACA,UAAUC,QAAQ,CAACH,KAAKI,QAAQ,GAAG;YACrC,OAAOH,GAAG,IAAII,6BAAmB,CAAC;QACrC;QACAJ,GAAG,MAAM;IACZ;AACH;AAEO,MAAMX,UAAU,OAAOgB;IAC3B,IAAI;QACD,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAMd,mBAAU,CAACG,QAAQ,CAACN,OAAO,CAACgB;QACrD,IAAIC,WAAW,aAAa;YACzB,OAAO;QACV,OAAO,IAAIA,WAAW,MAAM;YACzB,OAAO;QACV;QACA,OAAOA;IACV,EAAE,OAAOC,OAAO;QACb,OAAO;IACV;AACH;MAEA,WAAeZ"}