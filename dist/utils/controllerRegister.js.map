{"version":3,"sources":["../../src/utils/controllerRegister.ts"],"sourcesContent":["import express, { Application, Handler } from 'express';\r\nimport { IRouter } from '~/decorators/Methods';\r\nimport MetadataKeys from './metadata.key';\r\nimport { IController } from '~/decorators/Controller';\r\n\r\nfunction controllerRegister(app: Application, controllers: any[]) {\r\n   const info: Array<{ api: string; handler: string }> = [];\r\n   controllers.forEach((controller) => {\r\n      const controllerInstance: { [handlerName: string]: Handler } = new controller();\r\n      const baseController: IController = Reflect.getMetadata(MetadataKeys.BASE_PATH, controller);\r\n\r\n      const routers: IRouter[] = Reflect.getMetadata(MetadataKeys.ROUTER, controller);\r\n      const expresRouter = express.Router();\r\n      routers.forEach(({ method, handlerName, handlerPath, middlewares }) => {\r\n         expresRouter[method](\r\n            handlerPath,\r\n            ...baseController.middlewares,\r\n            ...middlewares,\r\n            controllerInstance[String(handlerName)].bind(controllerInstance)\r\n         );\r\n         info.push({\r\n            api: `${method.toLocaleLowerCase()} ${'/api' + baseController.basePath + handlerPath}`,\r\n            handler: `${controllerInstance.constructor.name} - ${String(handlerName)}`\r\n         });\r\n      });\r\n      app.use('/api' + baseController.basePath, expresRouter);\r\n   });\r\n   console.table(info);\r\n}\r\n\r\nexport default controllerRegister;\r\n"],"names":["controllerRegister","app","controllers","info","forEach","controller","controllerInstance","baseController","Reflect","getMetadata","MetadataKeys","BASE_PATH","routers","ROUTER","expresRouter","express","Router","method","handlerName","handlerPath","middlewares","String","bind","push","api","toLocaleLowerCase","basePath","handler","constructor","name","use","console","table"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA8BA;;;eAAA;;;kDA9B8C;sDAErB;;;;;;AAGzB,SAASA,mBAAmBC,GAAgB,EAAEC,WAAkB;IAC7D,MAAMC,OAAgD,EAAE;IACxDD,YAAYE,OAAO,CAAC,CAACC;QAClB,MAAMC,qBAAyD,IAAID;QACnE,MAAME,iBAA8BC,QAAQC,WAAW,CAACC,oBAAY,CAACC,SAAS,EAAEN;QAEhF,MAAMO,UAAqBJ,QAAQC,WAAW,CAACC,oBAAY,CAACG,MAAM,EAAER;QACpE,MAAMS,eAAeC,gBAAO,CAACC,MAAM;QACnCJ,QAAQR,OAAO,CAAC,CAAC,EAAEa,MAAM,EAAEC,WAAW,EAAEC,WAAW,EAAEC,WAAW,EAAE;YAC/DN,YAAY,CAACG,OAAO,CACjBE,gBACGZ,eAAea,WAAW,KAC1BA,aACHd,kBAAkB,CAACe,OAAOH,aAAa,CAACI,IAAI,CAAChB;YAEhDH,KAAKoB,IAAI,CAAC;gBACPC,KAAK,CAAC,EAAEP,OAAOQ,iBAAiB,GAAG,CAAC,EAAE,SAASlB,eAAemB,QAAQ,GAAGP,YAAY,CAAC;gBACtFQ,SAAS,CAAC,EAAErB,mBAAmBsB,WAAW,CAACC,IAAI,CAAC,GAAG,EAAER,OAAOH,aAAa,CAAC;YAC7E;QACH;QACAjB,IAAI6B,GAAG,CAAC,SAASvB,eAAemB,QAAQ,EAAEZ;IAC7C;IACAiB,QAAQC,KAAK,CAAC7B;AACjB;MAEA,WAAeH"}