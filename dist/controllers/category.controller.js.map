{"version":3,"sources":["../../src/controllers/category.controller.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { Controller, Delete, Get, Post, Put } from '~/decorators';\r\nimport { permission } from '~/middlewares/permission';\r\nimport uploader from '~/middlewares/uploader';\r\nimport CategoryRepository from '~/repositories/category.repository';\r\nimport ImageRepository from '~/repositories/image.repository';\r\nimport { CloudImage } from '~/types/image';\r\nimport { Roles } from '~/types/roles';\r\nimport OkResponse from '~/utils/response/response';\r\n\r\n@Controller('/category')\r\nclass CategoryController {\r\n   private categoryRepo = new CategoryRepository();\r\n   private imageRepo = new ImageRepository();\r\n\r\n   @Get('/')\r\n   async getAllCategory(req: Request, res: Response) {\r\n      const { page, limit = 20, filter = '' } = req.query;\r\n      const { result, pagination } = await this.categoryRepo.getAllCategory({\r\n         page,\r\n         limit,\r\n         filter\r\n      });\r\n      return OkResponse(res, {\r\n         metadata: result,\r\n         pagination\r\n      });\r\n   }\r\n\r\n   @Post('/', permission(Roles.ADMIN), uploader.single('image'))\r\n   async createCagetory(req: Request, res: Response) {\r\n      const name = req.body.name;\r\n      const image: CloudImage = req.file;\r\n\r\n      const imageResult = await this.imageRepo.createImage(image);\r\n\r\n      const categoryResult = await this.categoryRepo.createCategory({\r\n         name,\r\n         image: imageResult?._id\r\n      });\r\n\r\n      return OkResponse(res, { metadata: categoryResult });\r\n   }\r\n\r\n   @Put('/', permission(Roles.ADMIN), uploader.single('image'))\r\n   async updateCategory(req: Request, res: Response) {\r\n      const { _id, name } = req.body;\r\n      const image: CloudImage = req.file;\r\n\r\n      const imageResult = await this.imageRepo.createImage(image);\r\n\r\n      const categoryResult = await this.categoryRepo.updateCategory({\r\n         _id,\r\n         name,\r\n         image: imageResult?._id\r\n      });\r\n\r\n      return OkResponse(res, { metadata: categoryResult });\r\n   }\r\n\r\n   @Delete('/:id', permission(Roles.ADMIN))\r\n   async deleteCategory(req: Request, res: Response) {\r\n      const _id = req.params.id;\r\n\r\n      const result = await this.categoryRepo.deleteCategory(_id);\r\n      return OkResponse(res, { metadata: result });\r\n   }\r\n}\r\n\r\nexport default CategoryController;\r\n"],"names":["CategoryController","getAllCategory","req","res","page","limit","filter","query","result","pagination","categoryRepo","OkResponse","metadata","createCagetory","name","body","image","file","imageResult","imageRepo","createImage","categoryResult","createCategory","_id","updateCategory","deleteCategory","params","id","CategoryRepository","ImageRepository","Get","Post","permission","Roles","ADMIN","uploader","single","Put","Delete","Controller"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAqEA;;;eAAA;;;yBArEkC;4BACiB;4BACxB;mDACN;6DACU;0DACH;uBAEN;mDACC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvB,IAAA,AACMA,qBADN,MACMA;IAIH,MACMC,eAAeC,GAAY,EAAEC,GAAa,EAAE;QAC/C,MAAM,EAAEC,IAAI,EAAEC,QAAQ,EAAE,EAAEC,SAAS,EAAE,EAAE,GAAGJ,IAAIK,KAAK;QACnD,MAAM,EAAEC,MAAM,EAAEC,UAAU,EAAE,GAAG,MAAM,IAAI,CAACC,YAAY,CAACT,cAAc,CAAC;YACnEG;YACAC;YACAC;QACH;QACA,OAAOK,IAAAA,iBAAU,EAACR,KAAK;YACpBS,UAAUJ;YACVC;QACH;IACH;IAEA,MACMI,eAAeX,GAAY,EAAEC,GAAa,EAAE;QAC/C,MAAMW,OAAOZ,IAAIa,IAAI,CAACD,IAAI;QAC1B,MAAME,QAAoBd,IAAIe,IAAI;QAElC,MAAMC,cAAc,MAAM,IAAI,CAACC,SAAS,CAACC,WAAW,CAACJ;QAErD,MAAMK,iBAAiB,MAAM,IAAI,CAACX,YAAY,CAACY,cAAc,CAAC;YAC3DR;YACAE,KAAK,EAAEE,wBAAAA,kCAAAA,YAAaK,GAAG;QAC1B;QAEA,OAAOZ,IAAAA,iBAAU,EAACR,KAAK;YAAES,UAAUS;QAAe;IACrD;IAEA,MACMG,eAAetB,GAAY,EAAEC,GAAa,EAAE;QAC/C,MAAM,EAAEoB,GAAG,EAAET,IAAI,EAAE,GAAGZ,IAAIa,IAAI;QAC9B,MAAMC,QAAoBd,IAAIe,IAAI;QAElC,MAAMC,cAAc,MAAM,IAAI,CAACC,SAAS,CAACC,WAAW,CAACJ;QAErD,MAAMK,iBAAiB,MAAM,IAAI,CAACX,YAAY,CAACc,cAAc,CAAC;YAC3DD;YACAT;YACAE,KAAK,EAAEE,wBAAAA,kCAAAA,YAAaK,GAAG;QAC1B;QAEA,OAAOZ,IAAAA,iBAAU,EAACR,KAAK;YAAES,UAAUS;QAAe;IACrD;IAEA,MACMI,eAAevB,GAAY,EAAEC,GAAa,EAAE;QAC/C,MAAMoB,MAAMrB,IAAIwB,MAAM,CAACC,EAAE;QAEzB,MAAMnB,SAAS,MAAM,IAAI,CAACE,YAAY,CAACe,cAAc,CAACF;QACtD,OAAOZ,IAAAA,iBAAU,EAACR,KAAK;YAAES,UAAUJ;QAAO;IAC7C;;QAtDA,uBAAQE,gBAAe,IAAIkB,2BAAkB;QAC7C,uBAAQT,aAAY,IAAIU,wBAAe;;AAsD1C;;IApDIC,IAAAA,eAAG,EAAC;;;eACqB,gBAAO,4BAAP,gBAAO;eAAO,iBAAQ,4BAAR,iBAAQ;;;GAL7C9B;;IAkBF+B,IAAAA,gBAAI,EAAC,KAAKC,IAAAA,sBAAU,EAACC,YAAK,CAACC,KAAK,GAAGC,iBAAQ,CAACC,MAAM,CAAC;;;eAC1B,gBAAO,4BAAP,gBAAO;eAAO,iBAAQ,4BAAR,iBAAQ;;;GAnB7CpC;;IAiCFqC,IAAAA,eAAG,EAAC,KAAKL,IAAAA,sBAAU,EAACC,YAAK,CAACC,KAAK,GAAGC,iBAAQ,CAACC,MAAM,CAAC;;;eACzB,gBAAO,4BAAP,gBAAO;eAAO,iBAAQ,4BAAR,iBAAQ;;;GAlC7CpC;;IAiDFsC,IAAAA,kBAAM,EAAC,QAAQN,IAAAA,sBAAU,EAACC,YAAK,CAACC,KAAK;;;eACZ,gBAAO,4BAAP,gBAAO;eAAO,iBAAQ,4BAAR,iBAAQ;;;GAlD7ClC;AAAAA;IADLuC,IAAAA,sBAAU,EAAC;GACNvC;MA0DN,WAAeA"}