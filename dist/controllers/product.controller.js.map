{"version":3,"sources":["../../src/controllers/product.controller.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { Controller, Delete, Get, Post, Put } from '~/decorators';\r\nimport { CloudImage } from '~/types/image';\r\nimport uploader from '~/middlewares/uploader';\r\nimport ImageRepository from '~/repositories/image.repository';\r\nimport OkResponse from '~/utils/response/response';\r\nimport ProductRepository from '~/repositories/product.repository';\r\nimport { BadRequestException } from '~/utils/response';\r\nimport { permission } from '~/middlewares/permission';\r\nimport { Roles } from '~/types/roles';\r\n\r\n@Controller('/products')\r\nclass ProductController {\r\n   private imageRepo = new ImageRepository();\r\n   private productRepo = new ProductRepository();\r\n\r\n   @Get('/')\r\n   async getAllProduct(req: Request, res: Response) {\r\n      const { page = 1, limit = 20, filter = '' } = req.query;\r\n      const { result, pagination } = await this.productRepo.getAllProduct({ page, limit, filter });\r\n      return OkResponse(res, {\r\n         metadata: result,\r\n         pagination\r\n      });\r\n   }\r\n\r\n   @Get('/search')\r\n   async searchProduct(req: Request, res: Response) {\r\n      const {\r\n         page = 1,\r\n         limit = 20,\r\n         name = '',\r\n         fromPrice = 0,\r\n         toPrice,\r\n         sort = 'createdAt'\r\n      } = req.query;\r\n      const { result, pagination } = await this.productRepo.searchProduct({\r\n         page,\r\n         limit,\r\n         name,\r\n         fromPrice,\r\n         toPrice,\r\n         sort\r\n      } as any);\r\n      return OkResponse(res, { metadata: result, pagination });\r\n   }\r\n\r\n   @Get('/:id')\r\n   async getProductById(req: Request, res: Response) {\r\n      const _id = req.params.id;\r\n      const result = await this.productRepo.getProductById(_id);\r\n      return OkResponse(res, { metadata: result });\r\n   }\r\n\r\n   @Post('/', permission(Roles.ADMIN), uploader.array('image'))\r\n   async createProduct(req: Request, res: Response) {\r\n      const { name, category, price, quantity, detail, description } = req.body;\r\n      const file = req.files as CloudImage[];\r\n      const images = await this.imageRepo.createMultipleImage(file);\r\n\r\n      if (!images || images.length <= 0) {\r\n         throw new BadRequestException('Product images not be empty.');\r\n      }\r\n\r\n      const product = await this.productRepo.createProduct({\r\n         name,\r\n         images,\r\n         category,\r\n         price,\r\n         quantity,\r\n         detail,\r\n         description\r\n      });\r\n\r\n      return OkResponse(res, { metadata: product });\r\n   }\r\n\r\n   @Put('/', permission(Roles.ADMIN))\r\n   async updateProduct(req: Request, res: Response) {\r\n      const { _id, name, category, price, quantity, detail, description } = req.body;\r\n\r\n      const product = await this.productRepo.updateProduct({\r\n         _id,\r\n         name,\r\n         category,\r\n         price,\r\n         quantity,\r\n         detail,\r\n         description\r\n      });\r\n\r\n      return OkResponse(res, { metadata: product });\r\n   }\r\n\r\n   @Delete('/:id', permission(Roles.ADMIN))\r\n   async deleteProduct(req: Request, res: Response) {\r\n      const _id = req.params.id;\r\n      const result = await this.productRepo.deleteProduct(_id);\r\n      return OkResponse(res, { metadata: result });\r\n   }\r\n\r\n   // @Get('/suggestion')\r\n   // async getSuggestionProduct(req: Request, res: Response) {\r\n   //    const result = await this.productRepo.getSuggestionProduct();\r\n   //    return OkResponse(res, { metadata: result });\r\n   // }\r\n}\r\n\r\nexport default ProductController;\r\n"],"names":["ProductController","getAllProduct","req","res","page","limit","filter","query","result","pagination","productRepo","OkResponse","metadata","searchProduct","name","fromPrice","toPrice","sort","getProductById","_id","params","id","createProduct","category","price","quantity","detail","description","body","file","files","images","imageRepo","createMultipleImage","length","BadRequestException","product","updateProduct","deleteProduct","ImageRepository","ProductRepository","Get","Post","permission","Roles","ADMIN","uploader","array","Put","Delete","Controller"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}