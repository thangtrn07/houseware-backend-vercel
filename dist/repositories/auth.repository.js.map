{"version":3,"sources":["../../src/repositories/auth.repository.ts"],"sourcesContent":["import Account from '~/models/account.model';\r\nimport User from '~/models/user.model';\r\nimport filterUndefinedOrNullFields from '~/utils/filterUndefineOrNull';\r\nimport { BadRequestException, NotFoundException } from '~/utils/response';\r\n\r\nclass AuthRepository {\r\n   async register({ username, password, fullname, phone, address }) {\r\n      const isExist = await Account.findOne({ username });\r\n\r\n      if (isExist) {\r\n         throw new BadRequestException('Username have already exist.');\r\n      }\r\n\r\n      const account = await Account.create(filterUndefinedOrNullFields({ username, password }));\r\n\r\n      if (!account) {\r\n         throw new BadRequestException('Đã có lỗi');\r\n      }\r\n\r\n      const user = await User.create(\r\n         filterUndefinedOrNullFields({ fullname, phone, address, account: account?._id })\r\n      );\r\n\r\n      const result = await User.findOne({ _id: user._id }).populate('account').select('-password');\r\n\r\n      return result;\r\n   }\r\n\r\n   async changePassword({ username, password }) {\r\n      const result = await Account.findOneAndUpdate({ username }, { password });\r\n      if (!result) {\r\n         throw new BadRequestException('Not found account to change password.');\r\n      }\r\n      return result;\r\n   }\r\n}\r\n\r\nexport default AuthRepository;\r\n"],"names":["AuthRepository","register","username","password","fullname","phone","address","isExist","Account","findOne","BadRequestException","account","create","filterUndefinedOrNullFields","user","User","_id","result","populate","select","changePassword","findOneAndUpdate"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAqCA;;;eAAA;;;uDArCoB;oDACH;+DACuB;0BACe;;;;;;AAEvD,IAAA,AAAMA,iBAAN,MAAMA;IACH,MAAMC,SAAS,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,OAAO,EAAE,EAAE;QAC9D,MAAMC,UAAU,MAAMC,qBAAO,CAACC,OAAO,CAAC;YAAEP;QAAS;QAEjD,IAAIK,SAAS;YACV,MAAM,IAAIG,6BAAmB,CAAC;QACjC;QAEA,MAAMC,UAAU,MAAMH,qBAAO,CAACI,MAAM,CAACC,IAAAA,6BAA2B,EAAC;YAAEX;YAAUC;QAAS;QAEtF,IAAI,CAACQ,SAAS;YACX,MAAM,IAAID,6BAAmB,CAAC;QACjC;QAEA,MAAMI,OAAO,MAAMC,kBAAI,CAACH,MAAM,CAC3BC,IAAAA,6BAA2B,EAAC;YAAET;YAAUC;YAAOC;YAASK,OAAO,EAAEA,oBAAAA,8BAAAA,QAASK,GAAG;QAAC;QAGjF,MAAMC,SAAS,MAAMF,kBAAI,CAACN,OAAO,CAAC;YAAEO,KAAKF,KAAKE,GAAG;QAAC,GAAGE,QAAQ,CAAC,WAAWC,MAAM,CAAC;QAEhF,OAAOF;IACV;IAEA,MAAMG,eAAe,EAAElB,QAAQ,EAAEC,QAAQ,EAAE,EAAE;QAC1C,MAAMc,SAAS,MAAMT,qBAAO,CAACa,gBAAgB,CAAC;YAAEnB;QAAS,GAAG;YAAEC;QAAS;QACvE,IAAI,CAACc,QAAQ;YACV,MAAM,IAAIP,6BAAmB,CAAC;QACjC;QACA,OAAOO;IACV;AACH;MAEA,WAAejB"}