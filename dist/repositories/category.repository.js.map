{"version":3,"sources":["../../src/repositories/category.repository.ts"],"sourcesContent":["import Category from '~/models/category.model';\r\nimport Product from '~/models/product.model';\r\nimport filterUndefinedOrNullFields from '~/utils/filterUndefineOrNull';\r\nimport { BadRequestException, NotFoundException } from '~/utils/response';\r\n\r\nclass CategoryRepository {\r\n   async getAllCategory({ page, limit, filter }) {\r\n      const filterEl = {\r\n         name: {\r\n            $regex: `.*${filter}.*`,\r\n            $options: 'i'\r\n         }\r\n      };\r\n\r\n      if (!page) {\r\n         const result = await Category.find(filterEl).sort('createdAt')?.populate('image');\r\n         return { result };\r\n      }\r\n\r\n      const result = await Category.find(filterEl)\r\n         .sort('createdAt')\r\n         ?.populate('image')\r\n         ?.skip((page - 1) * limit)\r\n         .limit(limit);\r\n      const totalItem = await Category.count(filterEl);\r\n\r\n      return {\r\n         result,\r\n         pagination: {\r\n            page: Number(page),\r\n            limit: Number(limit),\r\n            totalPage: Math.ceil(totalItem / limit)\r\n         }\r\n      };\r\n   }\r\n\r\n   async createCategory({ name, image }) {\r\n      const category = await Category.create(filterUndefinedOrNullFields({ name, image }));\r\n      const result = await category?.populate('image');\r\n      return result;\r\n   }\r\n\r\n   async updateCategory({ _id, name, image }) {\r\n      const updateFields = filterUndefinedOrNullFields({ name, image });\r\n      const category = await Category.findByIdAndUpdate(_id, updateFields, { new: true });\r\n      if (!category) {\r\n         throw new NotFoundException('Not found category with _id: ' + _id);\r\n      }\r\n      const result = await category?.populate('image');\r\n      return result;\r\n   }\r\n\r\n   async deleteCategory(_id): Promise<any> {\r\n      if (!_id) {\r\n         throw new BadRequestException('Category _id must be required.');\r\n      }\r\n      const isExists = await Product.find({ category: _id });\r\n      if (isExists || isExists.length > 0) {\r\n         throw new BadRequestException('Some products using this category _id.');\r\n      }\r\n      return await Category.deleteOne({ _id });\r\n   }\r\n}\r\n\r\nexport default CategoryRepository;\r\n"],"names":["CategoryRepository","getAllCategory","page","limit","filter","Category","filterEl","name","$regex","$options","result","find","sort","populate","skip","totalItem","count","pagination","Number","totalPage","Math","ceil","createCategory","image","category","create","filterUndefinedOrNullFields","updateCategory","_id","updateFields","findByIdAndUpdate","new","NotFoundException","deleteCategory","BadRequestException","isExists","Product","length","deleteOne"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAgEA;;;eAAA;;;wDAhEqB;uDACD;+DACoB;0BACe;;;;;;AAEvD,IAAA,AAAMA,qBAAN,MAAMA;IACH,MAAMC,eAAe,EAAEC,IAAI,EAAEC,KAAK,EAAEC,MAAM,EAAE,EAAE;YAatBC,8BAAAA;QAZrB,MAAMC,WAAW;YACdC,MAAM;gBACHC,QAAQ,CAAC,EAAE,EAAEJ,OAAO,EAAE,CAAC;gBACvBK,UAAU;YACb;QACH;QAEA,IAAI,CAACP,MAAM;gBACaG;YAArB,MAAMK,SAAS,QAAML,uBAAAA,sBAAQ,CAACM,IAAI,CAACL,UAAUM,IAAI,CAAC,0BAA7BP,2CAAAA,qBAA2CQ,QAAQ,CAAC;YACzE,OAAO;gBAAEH;YAAO;QACnB;QAEA,MAAMA,SAAS,QAAML,sBAAAA,sBAAQ,CAACM,IAAI,CAACL,UAC/BM,IAAI,CAAC,0BADYP,2CAAAA,+BAAAA,oBAEhBQ,QAAQ,CAAC,sBAFOR,mDAAAA,6BAGhBS,IAAI,CAAC,AAACZ,CAAAA,OAAO,CAAA,IAAKC,OACnBA,KAAK,CAACA;QACV,MAAMY,YAAY,MAAMV,sBAAQ,CAACW,KAAK,CAACV;QAEvC,OAAO;YACJI;YACAO,YAAY;gBACTf,MAAMgB,OAAOhB;gBACbC,OAAOe,OAAOf;gBACdgB,WAAWC,KAAKC,IAAI,CAACN,YAAYZ;YACpC;QACH;IACH;IAEA,MAAMmB,eAAe,EAAEf,IAAI,EAAEgB,KAAK,EAAE,EAAE;QACnC,MAAMC,WAAW,MAAMnB,sBAAQ,CAACoB,MAAM,CAACC,IAAAA,6BAA2B,EAAC;YAAEnB;YAAMgB;QAAM;QACjF,MAAMb,SAAS,OAAMc,qBAAAA,+BAAAA,SAAUX,QAAQ,CAAC;QACxC,OAAOH;IACV;IAEA,MAAMiB,eAAe,EAAEC,GAAG,EAAErB,IAAI,EAAEgB,KAAK,EAAE,EAAE;QACxC,MAAMM,eAAeH,IAAAA,6BAA2B,EAAC;YAAEnB;YAAMgB;QAAM;QAC/D,MAAMC,WAAW,MAAMnB,sBAAQ,CAACyB,iBAAiB,CAACF,KAAKC,cAAc;YAAEE,KAAK;QAAK;QACjF,IAAI,CAACP,UAAU;YACZ,MAAM,IAAIQ,2BAAiB,CAAC,kCAAkCJ;QACjE;QACA,MAAMlB,SAAS,OAAMc,qBAAAA,+BAAAA,SAAUX,QAAQ,CAAC;QACxC,OAAOH;IACV;IAEA,MAAMuB,eAAeL,GAAG,EAAgB;QACrC,IAAI,CAACA,KAAK;YACP,MAAM,IAAIM,6BAAmB,CAAC;QACjC;QACA,MAAMC,WAAW,MAAMC,qBAAO,CAACzB,IAAI,CAAC;YAAEa,UAAUI;QAAI;QACpD,IAAIO,YAAYA,SAASE,MAAM,GAAG,GAAG;YAClC,MAAM,IAAIH,6BAAmB,CAAC;QACjC;QACA,OAAO,MAAM7B,sBAAQ,CAACiC,SAAS,CAAC;YAAEV;QAAI;IACzC;AACH;MAEA,WAAe5B"}